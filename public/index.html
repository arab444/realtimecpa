<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPA Dashboard - Real-time Tracking</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h1 {
            font-size: 32px;
            margin-bottom: 5px;
        }

        .subtitle {
            opacity: 0.9;
            font-size: 14px;
        }

        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            margin-top: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .live-indicator:hover {
            background: rgba(255,255,255,0.3);
        }

        .live-dot {
            width: 10px;
            height: 10px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .live-dot.paused {
            background: #ef4444;
            animation: none;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .metric-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            font-size: 24px;
        }

        .metric-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .metric-value {
            font-size: 32px;
            font-weight: bold;
            color: #333;
        }

        .metric-change {
            font-size: 12px;
            margin-top: 8px;
            color: #10b981;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            background: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .tab:hover {
            background: #f0f0f0;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .content-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #e5e5e5;
        }

        th {
            background: #f9f9f9;
            font-weight: 600;
            color: #666;
            font-size: 14px;
        }

        td {
            font-size: 14px;
        }

        tr:hover {
            background: #f9f9f9;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-approved {
            background: #d1fae5;
            color: #065f46;
        }

        .status-rejected {
            background: #fee2e2;
            color: #991b1b;
        }

        .filter-section {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        input, select, button {
            padding: 10px 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        button.primary {
            background: #667eea;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        button.primary:hover {
            background: #5568d3;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            h1 {
                font-size: 24px;
            }

            .metrics {
                grid-template-columns: 1fr;
            }

            .tabs {
                overflow-x: auto;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>CPA Dashboard</h1>
            <p class="subtitle">Monitor clicks, leads, dan revenue secara real-time</p>
            <div class="live-indicator" id="liveIndicator" onclick="toggleLive()">
                <span class="live-dot" id="liveDot"></span>
                <span id="liveText">LIVE - Auto Update</span>
            </div>
        </header>

        <div class="metrics">
            <div class="metric-card">
                <div class="metric-icon" style="background: #dbeafe; color: #1e40af;">üìä</div>
                <div class="metric-label">Total Clicks</div>
                <div class="metric-value" id="totalClicks">0</div>
                <div class="metric-change" id="clicksChange">+0 hari ini</div>
            </div>

            <div class="metric-card">
                <div class="metric-icon" style="background: #dcfce7; color: #15803d;">üéØ</div>
                <div class="metric-label">Total Leads</div>
                <div class="metric-value" id="totalLeads">0</div>
                <div class="metric-change" id="leadsChange">+0 hari ini</div>
            </div>

            <div class="metric-card">
                <div class="metric-icon" style="background: #fef3c7; color: #92400e;">‚è≥</div>
                <div class="metric-label">Pending Approval</div>
                <div class="metric-value" id="pendingLeads">0</div>
                <div class="metric-change">Menunggu verifikasi</div>
            </div>

            <div class="metric-card">
                <div class="metric-icon" style="background: #e0e7ff; color: #4338ca;">üí∞</div>
                <div class="metric-label">Total Revenue</div>
                <div class="metric-value" id="totalRevenue">$0.00</div>
                <div class="metric-change" id="revenueChange">+$0.00 hari ini</div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('overview')">Overview</button>
            <button class="tab" onclick="switchTab('clicks')">Real-time Clicks</button>
            <button class="tab" onclick="switchTab('leads')">Real-time Leads</button>
            <button class="tab" onclick="switchTab('subid')">Sub ID Report</button>
        </div>

        <div class="content-card">
            <div id="overview" class="tab-content active">
                <h2 style="margin-bottom: 20px;">Overview Dashboard</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    Selamat datang di dashboard CPA real-time. Semua data akan ter-update otomatis setiap 3 detik.
                </p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 30px;">
                    <div style="padding: 20px; background: #f9f9f9; border-radius: 8px;">
                        <h3 style="margin-bottom: 10px;">Conversion Rate</h3>
                        <div style="font-size: 28px; font-weight: bold; color: #667eea;" id="conversionRate">0%</div>
                    </div>
                    <div style="padding: 20px; background: #f9f9f9; border-radius: 8px;">
                        <h3 style="margin-bottom: 10px;">Avg Payout</h3>
                        <div style="font-size: 28px; font-weight: bold; color: #10b981;" id="avgPayout">$0.00</div>
                    </div>
                    <div style="padding: 20px; background: #f9f9f9; border-radius: 8px;">
                        <h3 style="margin-bottom: 10px;">Active Sub IDs</h3>
                        <div style="font-size: 28px; font-weight: bold; color: #f59e0b;" id="activeSubIds">0</div>
                    </div>
                </div>
            </div>

            <div id="clicks" class="tab-content">
                <h2 style="margin-bottom: 20px;">Real-time Clicks</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Waktu</th>
                            <th>Sub ID</th>
                            <th>IP Address</th>
                            <th>User Agent</th>
                            <th>Referrer</th>
                        </tr>
                    </thead>
                    <tbody id="clicksTable">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 40px; color: #999;">
                                Menunggu data clicks...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div id="leads" class="tab-content">
                <h2 style="margin-bottom: 20px;">Real-time Leads</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Waktu</th>
                            <th>Lead ID</th>
                            <th>Sub ID</th>
                            <th>Email</th>
                            <th>Payout</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="leadsTable">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px; color: #999;">
                                Menunggu data leads...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div id="subid" class="tab-content">
                <div class="filter-section">
                    <input type="text" id="filterSubId" placeholder="Filter by Sub ID..." style="flex: 1; min-width: 200px;">
                    <button class="primary" onclick="exportCSV()">Export to CSV</button>
                </div>
                <h2 style="margin-bottom: 20px;">Sub ID Performance Report</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Sub ID</th>
                            <th>Total Clicks</th>
                            <th>Total Leads</th>
                            <th>Approved</th>
                            <th>Pending</th>
                            <th>Rejected</th>
                            <th>Revenue</th>
                            <th>Conv. Rate</th>
                        </tr>
                    </thead>
                    <tbody id="subidTable">
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 40px; color: #999;">
                                Menunggu data Sub ID...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let clicks = [];
        let leads = [];
        let subIdStats = {};
        let isLive = true;
        let updateInterval;

        const countries = ['US', 'GB', 'ID', 'MY', 'SG', 'TH', 'PH', 'VN', 'IN', 'AU'];
        
        // Convert country code to emoji flag
        function getCountryFlag(countryCode) {
            if (!countryCode || countryCode.length !== 2) return 'üåê';
            const codePoints = countryCode
                .toUpperCase()
                .split('')
                .map(char => 127397 + char.charCodeAt(0));
            return String.fromCodePoint(...codePoints);
        }

        // Generate random data
        const subIds = ['SUB001', 'SUB002', 'SUB003', 'SUB004', 'SUB005'];
        const userAgents = [
            'Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0.0.0',
            'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) Safari/605.1.15',
            'Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) Safari/604.1',
            'Mozilla/5.0 (Android 13; Mobile) Chrome/120.0.0.0',
        ];
        const referrers = ['google.com', 'facebook.com', 'twitter.com', 'instagram.com', 'direct'];

        function generateIP() {
            return `${Math.floor(Math.random() * 256)}.${Math.floor(Math.random() * 256)}.${Math.floor(Math.random() * 256)}.${Math.floor(Math.random() * 256)}`;
        }

        function generateEmail() {
            const names = ['user', 'john', 'jane', 'test', 'demo', 'sample'];
            const domains = ['gmail.com', 'yahoo.com', 'outlook.com', 'email.com'];
            return `${names[Math.floor(Math.random() * names.length)]}${Math.floor(Math.random() * 1000)}@${domains[Math.floor(Math.random() * domains.length)]}`;
        }

        function formatTime(date) {
            return date.toLocaleTimeString('id-ID');
        }

        function formatCurrency(amount) {
            return `$${amount.toFixed(2)}`;
        }

        function generateClick() {
            const click = {
                time: new Date(),
                subId: subIds[Math.floor(Math.random() * subIds.length)],
                ip: generateIP(),
                userAgent: userAgents[Math.floor(Math.random() * userAgents.length)],
                referrer: referrers[Math.floor(Math.random() * referrers.length)],
                country: countries[Math.floor(Math.random() * countries.length)]
            };
            clicks.unshift(click);
            if (clicks.length > 100) clicks.pop();
            
            updateSubIdStats(click.subId, 'click');
            return click;
        }

        function generateLead() {
            const statuses = ['pending', 'approved', 'rejected'];
            const weights = [0.3, 0.6, 0.1]; // 30% pending, 60% approved, 10% rejected
            
            let random = Math.random();
            let status = statuses[0];
            let cumulative = 0;
            
            for (let i = 0; i < weights.length; i++) {
                cumulative += weights[i];
                if (random <= cumulative) {
                    status = statuses[i];
                    break;
                }
            }

            const payout = status === 'approved' ? parseFloat((Math.random() * 10 + 5).toFixed(2)) : 0;
            
            const lead = {
                time: new Date(),
                leadId: 'L' + Math.random().toString(36).substr(2, 9).toUpperCase(),
                subId: subIds[Math.floor(Math.random() * subIds.length)],
                email: generateEmail(),
                payout: payout,
                status: status,
                country: countries[Math.floor(Math.random() * countries.length)]
            };
            
            leads.unshift(lead);
            if (leads.length > 100) leads.pop();
            
            updateSubIdStats(lead.subId, 'lead', lead.status, lead.payout);
            return lead;
        }

        function updateSubIdStats(subId, type, status = null, payout = 0) {
            if (!subIdStats[subId]) {
                subIdStats[subId] = {
                    clicks: 0,
                    leads: 0,
                    approved: 0,
                    pending: 0,
                    rejected: 0,
                    revenue: 0
                };
            }

            if (type === 'click') {
                subIdStats[subId].clicks++;
            } else if (type === 'lead') {
                subIdStats[subId].leads++;
                if (status === 'approved') {
                    subIdStats[subId].approved++;
                    subIdStats[subId].revenue += payout;
                } else if (status === 'pending') {
                    subIdStats[subId].pending++;
                } else if (status === 'rejected') {
                    subIdStats[subId].rejected++;
                }
            }
        }

        function updateMetrics() {
            const totalClicks = clicks.length;
            const totalLeads = leads.length;
            const approvedLeads = leads.filter(l => l.status === 'approved').length;
            const pendingLeads = leads.filter(l => l.status === 'pending').length;
            const totalRevenue = leads.reduce((sum, l) => sum + l.payout, 0);

            document.getElementById('totalClicks').textContent = totalClicks;
            document.getElementById('totalLeads').textContent = totalLeads;
            document.getElementById('pendingLeads').textContent = pendingLeads;
            document.getElementById('totalRevenue').textContent = formatCurrency(totalRevenue);

            const convRate = totalClicks > 0 ? ((totalLeads / totalClicks) * 100).toFixed(2) : 0;
            document.getElementById('conversionRate').textContent = convRate + '%';

            const avgPayout = approvedLeads > 0 ? totalRevenue / approvedLeads : 0;
            document.getElementById('avgPayout').textContent = formatCurrency(avgPayout);

            document.getElementById('activeSubIds').textContent = Object.keys(subIdStats).length;

            // Update change indicators
            document.getElementById('clicksChange').textContent = `+${Math.floor(totalClicks * 0.3)} hari ini`;
            document.getElementById('leadsChange').textContent = `+${Math.floor(totalLeads * 0.3)} hari ini`;
            document.getElementById('revenueChange').textContent = `+${formatCurrency(totalRevenue * 0.3)} hari ini`;
        }

        function updateClicksTable() {
            const tbody = document.getElementById('clicksTable');
            if (clicks.length === 0) return;

            const html = clicks.slice(0, 20).map(click => `
                <tr>
                    <td>${formatTime(click.time)}</td>
                    <td><strong>${click.subId}</strong></td>
                    <td>
                        <span style="font-size: 18px; margin-right: 6px;">${getCountryFlag(click.country)}</span>
                        ${click.country} ‚Ä¢ ${click.ip}
                    </td>
                    <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${click.userAgent}</td>
                    <td>${click.referrer}</td>
                </tr>
            `).join('');

            tbody.innerHTML = html;
        }

        function updateLeadsTable() {
            const tbody = document.getElementById('leadsTable');
            if (leads.length === 0) return;

            const html = leads.slice(0, 20).map(lead => `
                <tr>
                    <td>${formatTime(lead.time)}</td>
                    <td><strong>${lead.leadId}</strong></td>
                    <td>
                        <span style="font-size: 18px; margin-right: 6px;">${getCountryFlag(lead.country)}</span>
                        <strong>${lead.subId}</strong>
                    </td>
                    <td>${lead.email}</td>
                    <td><strong style="color: #10b981;">${formatCurrency(lead.payout)}</strong></td>
                    <td><span class="status-badge status-${lead.status}">${lead.status.toUpperCase()}</span></td>
                </tr>
            `).join('');

            tbody.innerHTML = html;
        }

        function updateSubIdTable() {
            const tbody = document.getElementById('subidTable');
            const filterValue = document.getElementById('filterSubId').value.toLowerCase();

            let filteredStats = Object.entries(subIdStats);
            if (filterValue) {
                filteredStats = filteredStats.filter(([subId]) => subId.toLowerCase().includes(filterValue));
            }

            if (filteredStats.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 40px; color: #999;">Tidak ada data</td></tr>';
                return;
            }

            const html = filteredStats.map(([subId, stats]) => {
                const convRate = stats.clicks > 0 ? ((stats.leads / stats.clicks) * 100).toFixed(2) : 0;
                return `
                    <tr>
                        <td><strong>${subId}</strong></td>
                        <td>${stats.clicks}</td>
                        <td>${stats.leads}</td>
                        <td style="color: #10b981;">${stats.approved}</td>
                        <td style="color: #f59e0b;">${stats.pending}</td>
                        <td style="color: #ef4444;">${stats.rejected}</td>
                        <td><strong>${formatCurrency(stats.revenue)}</strong></td>
                        <td>${convRate}%</td>
                    </tr>
                `;
            }).join('');

            tbody.innerHTML = html;
        }

        function updateAll() {
            updateMetrics();
            updateClicksTable();
            updateLeadsTable();
            updateSubIdTable();
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
        }

        function toggleLive() {
            isLive = !isLive;
            const liveDot = document.getElementById('liveDot');
            const liveText = document.getElementById('liveText');

            if (isLive) {
                liveDot.classList.remove('paused');
                liveText.textContent = 'LIVE - Auto Update';
                startSimulation();
            } else {
                liveDot.classList.add('paused');
                liveText.textContent = 'PAUSED - Click to Resume';
                stopSimulation();
            }
        }

        function exportCSV() {
            const rows = [
                ['Sub ID', 'Total Clicks', 'Total Leads', 'Approved', 'Pending', 'Rejected', 'Revenue', 'Conv Rate']
            ];

            Object.entries(subIdStats).forEach(([subId, stats]) => {
                const convRate = stats.clicks > 0 ? ((stats.leads / stats.clicks) * 100).toFixed(2) : 0;
                rows.push([
                    subId,
                    stats.clicks,
                    stats.leads,
                    stats.approved,
                    stats.pending,
                    stats.rejected,
                    stats.revenue.toFixed(2),
                    convRate + '%'
                ]);
            });

            const csv = rows.map(row => row.join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cpa-report-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function startSimulation() {
            if (updateInterval) clearInterval(updateInterval);

            // Generate initial data
            for (let i = 0; i < 10; i++) {
                generateClick();
                if (Math.random() > 0.7) generateLead();
            }
            updateAll();

            // Auto update every 3 seconds
            updateInterval = setInterval(() => {
                if (isLive) {
                    // Random chance to generate click or lead
                    if (Math.random() > 0.3) generateClick();
                    if (Math.random() > 0.7) generateLead();
                    updateAll();
                }
            }, 3000);
        }

        function stopSimulation() {
            if (updateInterval) {
                clearInterval(updateInterval);
                updateInterval = null;
            }
        }

        // Filter Sub ID in real-time
        document.getElementById('filterSubId').addEventListener('input', updateSubIdTable);

        // Start simulation on page load
        window.onload = () => {
            startSimulation();
        };
    </script>
</body>
</html>
